<!DOCTYPE html><html><head><meta name="generator" content="Hexo 3.9.0"><meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1.0, shrink-to-fit=no, user-scalable=no"><meta name="apple-mobile-web-app-capable" content="yes"><meta http-equiv="content-type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="title" content="花萼横江"><meta name="sub title"><meta name="description" content="花萼横江"><meta name="key words"><meta name="author" content="王品"><meta name="language" content="zh-CN"><title>react context 入门</title><link rel="stylesheet" type="text/css" href="/css/reset.css"><link rel="stylesheet" type="text/css" href="/css/index.css"><link rel="stylesheet" type="text/css" href="/css/nav.css"><link rel="stylesheet" type="text/css" href="/css/wigets.css"><link rel="stylesheet" type="text/css" href="/css/code.css"></head><body> <nav><div class="top-bar">花萼横江</div><label class="mobile-menu"><input type="checkbox"><div class="items"><a href="/">首页</a><a href="/about">关于</a><a href="/projects">项目</a><a href="/archives">归档</a></div><div class="overlap"></div></label></nav><section class="body"><article><header><h1><a href="/2019/05/08/react-context-入门/">react context 入门</a></h1><div class="metadata">创建于 2019年05月08日   最后一次更新于 2021-03-03 03:11</div></header><main><div class="summary">如果想要在组件中优雅的访问公共数据（通常是静态的），你肯定不想通过组建树自顶向下层层传递这些数据，因为真的很繁琐。那么，学习如何使用 react context 来解决这个难题把。</div><div class="dividing-line"></div><h1><span id="why">Why？</span></h1>
<p>通过 props 将数据层层传递<strong>下去</strong>是最常见的方式，也是最简单的。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Child</span> <span class="attr">data</span>=<span class="string">&#123;data&#125;/</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>如果 child 层次太深，props 传递会非常啰嗦。</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line">&lt;Parent1 data=&#123;data&#125;/&gt;</span><br><span class="line">&lt;Parent2 data=&#123;data&#125;/&gt;</span><br><span class="line">&lt;Parent3 data=&#123;data&#125;/&gt;</span><br><span class="line">&lt;Child data=&#123;data&#125;/&gt;</span><br></pre></td></tr></table></figure>
<p>或者换一种思路，让 child 自己访问数据 - 这就是 context：在 context 中存储一些任何 child 都有可能访问的数据，然后在 component 中访问 context 对应的数据（也可以修改）。context 不那么常用，但很有必要掌握。</p>
<blockquote>
<p>通常，你可以采用 redux 来解决上述问题（redux 也是构建于 context 之上的），如果你并不熟悉 redux 或者由于任何原因不想采用 redux 作为数据管理方案，可以使用本文介绍的 context 。</p>
</blockquote>
<h1><span id="get-started">Get started</span></h1>
<p>context 包含下面几个核心概念。</p>
<ol>
<li>createContext</li>
<li>assign context</li>
<li>provider</li>
<li>consumer</li>
</ol>
<p>分别说明：</p>
<h2><span id="createcontext">createContext</span></h2>
<p>顾名思义，创建一个 context:</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> MyContext = React.createContext(defaultValue);</span><br></pre></td></tr></table></figure>
<p>默认值可以给也可以不给。</p>
<h2><span id="assign-context">Assign context</span></h2>
<p>新创建的 context 是独立存在的，如果要在 component 里面访问 context，需要先建立联系。方式有两种，这里先说第一种 assign context。顾名思义，就是直接将 context 分配给某个 component。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyComponent</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  render () &#123;</span><br><span class="line">    <span class="keyword">let</span> value = <span class="keyword">this</span>.context;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;&#123;value&#125;&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    )</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">MyComponent.contextType = MyContext;</span></span><br></pre></td></tr></table></figure>
<p>也可以使用 public class fields syntax, 这样写：</p>
<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyComponent</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  static contextType = <span class="type">MyContext</span>.</span><br><span class="line">  render () &#123;</span><br><span class="line">    let value = <span class="keyword">this</span>.context;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;&#123;value&#125;&lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2><span id="provider-和-consumer">Provider 和 Consumer</span></h2>
<p>Provider 用于配置初始数据，Consumer 用于<strong>按需订阅</strong> context。</p>
<h3><span id="配置-provider">配置 Provider</span></h3>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;MyContext.Provider value=&#123;<span class="comment">/**/</span>&#125;&gt;</span><br><span class="line">  &lt;App/&gt;</span><br><span class="line">&lt;<span class="regexp">/MyContext.Provider&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>注意</strong>，此处 value 是必须提供的。</p>
<h3><span id="按需订阅">按需订阅</span></h3>
<p>在 component 内部通过对应的 Consumer 获取 value。这里完全可以根据具体业务决定是否访问 context，比 assign context 更灵活可控。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyComponent</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  render () &#123;</span><br><span class="line">    <span class="keyword">let</span> value = <span class="keyword">this</span>.context;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;MyContext.Consumer&gt;</span><br><span class="line">        &#123;value =&gt; (</span><br><span class="line">           &lt;div&gt;&#123;value&#125;&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">         ) </span></span><br><span class="line"><span class="regexp">        &#125;</span></span><br><span class="line"><span class="regexp">      &lt;MyContext.Consumer&gt;</span></span><br><span class="line"><span class="regexp">    )</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure>
<h2><span id="defaultvalue">defaultValue</span></h2>
<p>你可能会注意到一旦使用 Provider &amp; Context， value 是必须提供的，所以 defaultValue 不会起作用。因此，defaultValue 只能在使用第一种办法 Assign Context 时生效。一般 defaultValue 可以忽略。</p>
<h2><span id="更新-value">更新 value</span></h2>
<p>常见的做法是将 value 存储为 root component 的 state 或者子属性，然后更新对应数据。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// index.jsx</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">    <span class="keyword">this</span>.state = &#123; <span class="attr">context</span>: &#123;&#125; &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  handleConextChange = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// change state here</span></span><br><span class="line">  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    &lt;Provider value=&#123;<span class="keyword">this</span>.state.context&#125;&gt;</span><br><span class="line">      &lt;App handleContextChange=&#123;<span class="keyword">this</span>.handleConextChange&#125;/&gt;</span><br><span class="line">    &lt;<span class="regexp">/Provider&gt;</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure>
<p>context value 不必一定是 plain object，也可以包含 function，这样的好处是可以直接将操作 context 的通过 context 的方式传递给 child component，但我不推荐这种写法。</p>
<h1><span id="usecontext-hooks">UseContext Hooks</span></h1>
<p>React 16.8.x 发布了一系列 hooks api，旨在改变以往 class component 的诸多问题（开发和运行效率，可阅读性）。如果你喜欢 hooks，那也可以尝试下 useContext。</p>
<figure class="highlight cs"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">value</span> = useContext(MyContext)</span><br></pre></td></tr></table></figure>
<p>useContext 等价于上面介绍的 assign context。</p>
</main></article></section><footer><section class="links"> <a href="atom.xml"> <span class="icon" name="rss"></span></a><a href="https://github.com/wangpin34"> <span class="icon" name="github"></span></a><a href="https://hexo.io">Hexo</a></section><section class="copyright">© 2019 王品</section></footer></body></html>